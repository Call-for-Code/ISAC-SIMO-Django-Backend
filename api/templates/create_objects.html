{% extends 'master/base.html' %}

{% block title %} Object Type {% if project_filter %}for {{project_filter|title}}{% endif %} {% endblock title %}
{% block dashboard_title1 %} Object Type {% if project_filter %}for {{project_filter|title}}{% endif %} {% endblock dashboard_title1 %}
{% block dashboard_title2 %} View & Create Object Type {% endblock dashboard_title2 %}
{% load static %}

{% block content %}
    <style>
        .bs-tooltip-auto[x-placement^=top] .arrow, .bs-tooltip-top .arrow{transform:translate(6px,0)}
    </style>
    <div class="row">
        <div class="col-sm-12 col-md-8">
            <div class="card">
                <div class="card-title ml-3 mt-2">
                    <a href="{% url 'watson.object' %}"  class="btn btn-primary">
                        <i class="fas fa-arrow-right"></i> Fetch Object Type Details from IBM Watson
                    </a>
                    {% if project_filter %}
                        <a href="{% url 'watson.object.list' %}"  class="btn btn-secondary pull-right" style="float: right;margin-right: 10px;">
                            <i class="fas fa-arrow-right"></i> Show all
                        </a>
                    {% endif %}
                </div>
                <div class="card-body table table-responsive">
                    <table id="object_types" class="table table-bordered table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Project</th>
                                <th>Added By</th>
                                {% if user.is_admin or user.is_project_admin %}<th style="width:210px;">Actions</th>{% endif %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for object_type in object_types %}
                                <tr>
                                    <td data-toggle="tooltip" data-placement="top" title="{{object_type.instruction|default:''}}">{{object_type.name|title}}</td>
                                    <td>{{object_type.project.project_name|title|default:'N/A'}} {% if object_type.project.guest %} <i class="fa fa-globe text-success ml-1" title="Global Project" data-toggle="tooltip" data-placement="right"></i> {% endif %} {% if object_type.project.public %} <i class="fa fa-bullhorn text-primary ml-1" title="Public Project" data-toggle="tooltip" data-placement="right"></i> {% endif %}</td>
                                    <td>{{object_type.created_by.full_name|default:'User'}}</td>
                                    {% if user.is_admin or user.is_project_admin %}
                                    <td class="table-options" style="min-width: 170px;">
                                        <a title="View Image" data-toggle="tooltip" data-placement="left" href="#!" onclick="showImagePop(event,'{% if object_type.image %}{{object_type.image.url}}{% else %}/media/object_types/default.jpg{% endif %}')" class="btn text-secondary px-0" style="margin: 0 4px !important;">
                                            <i class="fa fa-file-image"></i>
                                        </a>
                                        {% if user.is_admin %}
                                        <a title="Quick Test Images" data-toggle="tooltip" data-placement="left" href="{% url 'images.add' %}?object_type_id={{object_type.id}}" class="btn text-secondary px-0" style="margin: 0 4px !important;">
                                            <i class="fa fa-plus-circle" style="color:green;"></i>
                                        </a>
                                        {% endif %}
                                        <a onclick="deleteDataWriteConfirm(event, 'form-{{ object_type.id }}', 'Object Type')" title="Delete" data-toggle="tooltip" data-placement="left" href="{% url 'watson.object.delete' object_type.id %}" class="btn text-secondary px-0" style="margin: 0 3px !important;">
                                            <i class="fa fa-trash text-danger"></i>
                                        </a>
                                        <a onclick="editForm('{{object_type.id}}','{{object_type.name}}','{{object_type.image.url}}','{{object_type.project_id}}','{{object_type.instruction|default:''}}')" title="Edit" data-toggle="tooltip" data-placement="left" href="#" class="btn text-secondary px-0" style="margin: 0 3px !important;">
                                            <i class="fa fa-edit"></i>
                                        </a>
                                        <a data-html="true" title="Quick Order Classifiers" data-toggle="tooltip" data-placement="right" href="{% url 'watson.classifier.order' object_type.id %}" class="btn text-secondary px-0" style="margin: 0 3px !important;">
                                            <i class="fa fa-sort-amount-up text-secondary"></i>
                                        </a>
                                        {% comment %} VERIFY / UN-VERIFY {% endcomment %}
                                        {% if object_type.verified %}
                                        <a onclick="confirmWithForm(event, 'form-verify-{{ object_type.id }}', 'Mark this Object ({{object_type.name|title}}) as Un-Verified')" title="Mark Un-Verified" data-toggle="tooltip" data-placement="right" href="#!" class="btn text-secondary px-0" style="margin: 0 3px !important;">
                                            <i class="fa fa-check-circle text-success"></i>
                                        </a>
                                        {% else %}
                                        <a onclick="confirmWithForm(event, 'form-verify-{{ object_type.id }}', 'Mark this Object ({{object_type.name|title}}) as Verified âœ“')" title="Mark Verified" data-toggle="tooltip" data-placement="right" href="#!" class="btn text-secondary px-0" style="margin: 0 3px !important;">
                                            <i class="fa fa-times-circle text-orange"></i>
                                        </a>
                                        {% endif %}
                                        {% comment %} WISHLIST / UN-WISHLIST {% endcomment %}
                                        {% if object_type.project.public %}
                                        {% if object_type.wishlist %}
                                        <a onclick="confirmWithForm(event, 'form-wishlist-{{ object_type.id }}', 'Remove from Wishlist? (Contributions will be paused for {{object_type.name|title}}. You can still view old contributions from public project page.)')" title="Remove from Wishlist & Pause Contribution" data-toggle="tooltip" data-placement="right" href="#!" class="btn text-secondary px-0" style="margin: 0 3px !important;">
                                            <i class="fa fa-bookmark text-success"></i>
                                        </a>
                                        {% else %}
                                        <a onclick="confirmWithForm(event, 'form-wishlist-{{ object_type.id }}', 'Add to Wishlist? (Users will immediately be able to Contribute to {{object_type.name|title}})')" title="Add to Wishlist" data-toggle="tooltip" data-placement="right" href="#!" class="btn text-secondary px-0" style="margin: 0 3px !important;">
                                            <i class="far fa-bookmark text-orange"></i>
                                        </a>
                                        {% endif %}
                                        {% endif %}
                                        <a data-html="true" title="View Classifiers for {{object_type.name|title}} <br/> {{object_type.classifiers.count}} Classifiers Available" data-toggle="tooltip" data-placement="right" href="{% url 'watson.classifier.list' %}?object_type={{object_type.id}}" class="btn text-secondary px-0" style="margin: 0 3px !important;">
                                            <i class="fa fa-arrow-right text-info"></i>
                                        </a>
                                        <form action="{% url 'watson.object.delete' object_type.id %}" id="form-{{ object_type.id }}" class="d-inline">
                                            {% csrf_token %}
                                        </form>
                                        <form action="{% url 'watson.object.verify' object_type.id %}" method="POST" id="form-verify-{{ object_type.id }}" class="d-inline">
                                            {% csrf_token %}
                                        </form>
                                        <form action="{% url 'watson.object.wishlist' object_type.id %}" method="POST" id="form-wishlist-{{ object_type.id }}" class="d-inline">
                                            {% csrf_token %}
                                        </form>
                                    </td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        </tbody> 
                    </table>
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-4">
            <div class="card">
                <div class="card-title ml-3 mt-3">
                    <h5>Create Object Type</h5>
                </div>
                <hr style="margin:0.5rem;"/>
                <div class="card-body pt-0">
                    <form action="{% url 'watson.object.create' %}" method="POST" id="object_type_create_form" class="d-inline" enctype="multipart/form-data">
                        {% csrf_token %}
                        <input type="hidden" value="0" id="id_field" name="id"/>
                        <div class="form-group mb-0">
                            <label for="object_type" class="col-12 col-form-label">Object Type*</label>
                            <div class="col-sm-12">
                                <input type="text" placeholder="Object Type (e.g. wall, rebar)" class="form-control" id="object_type" name="object_type" required/>
                            </div>
                            <small id="negativeHelp" class="col-sm-12 form-text text-muted">
                                Must be unique and lowercase for each project
                            </small>
                        </div>
                        <div class="form-group">
                            <label for="project" class="col-12 col-form-label">Project*</label>
                            <div class="col-sm-12">
                                <select class="form-control" id="project" name="project" required>
                                    {% for project in projects %}
                                        <option value="{{project.id}}" title="{{project.project_desc|default:''}} - {{project.detect_model|default:'No Detect Model'}}">{{project.project_name}}</option>
                                    {% endfor %}
                                    <!-- <option value="0" title="Default Project (Made for Guest User)">Global Project (Guest User)</option> -->
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="instruction" class="col-12 col-form-label">Instruction</label>
                            <div class="col-sm-12">
                                <textarea placeholder="Instruction for Mobile User.&#10;How to take Picture/Video" class="form-control" id="instruction" name="instruction" max="500"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="image" class="col-12 col-form-label">Instruction Image</label>
                            <div class="col-sm-12">
                                <input type="file" id="image" name="image" accept="image/x-png,image/jpeg"/>
                            </div>
                            <p style="display:none;font-size:0.7em;margin-left: 8px;margin-top: 3px;" id="file_path"></p>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-12" style="display: flex;justify-content: space-between;align-items: center;">
                                <button class="btn btn-sm btn-primary" id="submit_button" type="submit">Add</button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="createForm(event)" type="reset">Clear <i class="fa fa-backspace ml-1" style="font-size: 80%;"></i></button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block script %}
    <script>
        $(function () {
          $('#object_types').DataTable({
            "paging": true,
            "lengthChange": true,
            "searching": true,
            "ordering": true,
            "info": true,
            "autoWidth": true,
            "order": [],
            "language": {
			    "emptyTable": "No Object Type Available {% if project_filter %}for {{project_filter|title}}{% endif %}"
			}
          });
          $('#project').select2()
        });

        function editForm(id, name, url, project_id, instruction){
          $('#id_field').val(id);
          $('#object_type').val(name);
          $('#instruction').val(instruction);
          $('#project').val(project_id).trigger('change');
          $('#file_path').css("display","block");
          $('#file_path').html('Previous: <a href="'+url+'" target="_blank">'+url+'</a>');
          $('#submit_button').text("Update");
        }

        function createForm(event){
          event.preventDefault();
          $('#id_field').val(0);
          $('#object_type').val("");
          $('#instruction').val("");
          $('#image').val("");
          $('#project').val(null).trigger('change');
          $('#file_path').css("display","none");
          $('#file_path').html('');
          $('#submit_button').text("Add");
        }
    </script>
{% endblock script %}